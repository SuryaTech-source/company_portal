<div class="employees-add_new_employees mt-3">
  <h1 class="page_title">
    {{
    mode === "add"
    ? "Add Employee"
    : mode === "edit"
    ? "Edit Employee"
    : "View Employee"
    }}
  </h1>

  <form #employeeForm="ngForm" (ngSubmit)="submitForm(employeeForm)">

    <!-- Personal Details -->
    <h5 class="mb-3 mt-4 border-bottom pb-2">Personal Details</h5>
    <div class="row">
      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" class="form-control" [(ngModel)]="fullName" name="fullName" #fullNameCtrl="ngModel"
            [readonly]="readonly" required maxlength="25" pattern="^[A-Za-z ]+$" />
          <div *ngIf="employeeForm.submitted && fullNameCtrl.errors" class="text-danger small">
            <div *ngIf="fullNameCtrl.errors['required']">
              Full Name is required.
            </div>
            <div *ngIf="fullNameCtrl.errors['maxlength']">
              Maximum 25 letters allowed.
            </div>
            <div *ngIf="fullNameCtrl.errors['pattern']">
              Only alphabets allowed.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Nationality</label>
          <input type="text" class="form-control" [(ngModel)]="nationality" name="nationality"
            #nationalityCtrl="ngModel" [readonly]="readonly" required maxlength="30" pattern="^[A-Za-z ]+$" />
          <div *ngIf="employeeForm.submitted && nationalityCtrl.errors" class="text-danger small">
            <div *ngIf="nationalityCtrl.errors['required']">
              Nationality is required.
            </div>
            <div *ngIf="nationalityCtrl.errors['maxlength']">
              Maximum 30 letters allowed.
            </div>
            <div *ngIf="nationalityCtrl.errors['pattern']">
              Only alphabets allowed.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Blood Group</label>
          <select class="form-control" [(ngModel)]="bloodGroup" name="bloodGroup" #bloodGroupCtrl="ngModel"
            [disabled]="readonly" required>
            <option value="">-- Select Blood Group --</option>
            <option *ngFor="let group of bloodGroups" [value]="group">
              {{ group }}
            </option>
          </select>
          <div *ngIf="employeeForm.submitted && bloodGroupCtrl.errors" class="text-danger small">
            <div *ngIf="bloodGroupCtrl.errors['required']">
              Blood Group is required.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Date of Birth</label>
          <input type="date" class="form-control" [(ngModel)]="dob" name="dob" #dobCtrl="ngModel" [readonly]="readonly"
            required />
          <div *ngIf="employeeForm.submitted && dobCtrl.errors" class="text-danger small">
            <div *ngIf="dobCtrl.errors['required']">
              Date of Birth is required.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-12 col-lg-8">
        <div class="form-group">
          <label>Permanent Address</label>
          <textarea class="form-control" rows="1" [(ngModel)]="permanentAddress" name="permanentAddress"
            #addressCtrl="ngModel" [readonly]="readonly" required></textarea>
          <div *ngIf="employeeForm.submitted && addressCtrl.errors" class="text-danger small">
            <div *ngIf="addressCtrl.errors['required']">
              Permanent Address is required.
            </div>
            <div *ngIf="addressCtrl.errors['maxlength']">
              Maximum 30 letters allowed.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Employment Details -->
    <h5 class="mb-3 mt-4 border-bottom pb-2">Employment Details</h5>
    <div class="row">
      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Employee ID</label>
          <input type="text" class="form-control" [(ngModel)]="employeeId" name="employeeId" #empIdCtrl="ngModel"
            [readonly]="readonly" required maxlength="30" />
          <div *ngIf="employeeForm.submitted && empIdCtrl.errors" class="text-danger small">
            <div *ngIf="empIdCtrl.errors['required']">
              Employee ID is required.
            </div>
            <div *ngIf="empIdCtrl.errors['maxlength']">
              Maximum 30 characters allowed.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Designation</label>
          <select class="form-control" [(ngModel)]="designation" name="designation" #designationCtrl="ngModel"
            [disabled]="readonly" required>
            <option value="">-- Select Designation --</option>
            <option value="Supervisor">Supervisor</option>
            <option value="Driver">Driver</option>
            <option value="Mechanic">Mechanic</option>
            <option value="Helper">Helper</option>
            <option value="Others">Others</option>
          </select>
          <div *ngIf="employeeForm.submitted && designationCtrl.errors" class="text-danger small">
            <div *ngIf="designationCtrl.errors['required']">
              Designation is required.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Employment Type</label>
          <select class="form-control" [(ngModel)]="employmentType" name="employmentType" [disabled]="readonly"
            required>
            <option value="Full-Time">Full-Time</option>
            <option value="Part-Time">Part-Time</option>
            <option value="Contract">Contract</option>
          </select>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Date of Joining</label>
          <input type="date" class="form-control" [(ngModel)]="dateOfJoining" name="dateOfJoining" #dojCtrl="ngModel"
            [readonly]="readonly" required />
          <div *ngIf="employeeForm.submitted && dojCtrl.errors" class="text-danger small">
            <div *ngIf="dojCtrl.errors['required']">
              Date of Joining is required.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Under Contract</label>
          <select class="form-control" [(ngModel)]="underContract" name="underContract" [disabled]="readonly" required>
            <option value="" disabled>Select</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
          <div *ngIf="employeeForm.submitted && !underContract" class="text-danger small">
            Under Contract is required.
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Salary</label>
          <input type="text" class="form-control" [(ngModel)]="salary" name="salary" #salaryCtrl="ngModel"
            [readonly]="readonly" required maxlength="10" (keypress)="allowOnlyNumbers($event)" />
          <div *ngIf="employeeForm.submitted && salaryCtrl.errors" class="text-danger small">
            <div *ngIf="salaryCtrl.errors['required']">
              Salary is required.
            </div>
            <div *ngIf="salaryCtrl.errors['maxlength']">
              Maximum 10 digits allowed.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4" *ngIf="mode !== 'add'">
        <div class="form-group">
          <label>Status</label>
          <select class="form-control" [(ngModel)]="status" name="status" [disabled]="readonly">
            <option [value]="1">Active</option>
            <option [value]="2">Inactive</option>
            <option [value]="0">Deleted</option>
          </select>
        </div>
      </div>
    </div>

    <!-- IDs and Permits -->
    <h5 class="mb-3 mt-4 border-bottom pb-2">IDs and Permits</h5>
    <div class="row">
      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Civil ID (Visa No)</label>
          <input type="text" class="form-control" [(ngModel)]="civilId" name="civilId" #civilIdCtrl="ngModel"
            [readonly]="readonly" required maxlength="30" />
          <div *ngIf="employeeForm.submitted && civilIdCtrl.errors" class="text-danger small">
            <div *ngIf="civilIdCtrl.errors['required']">
              Civil ID is required.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Civil ID Expiry</label>
          <input type="date" class="form-control" [(ngModel)]="civilIdExpiry" name="civilIdExpiry"
            #civilIdExpiryCtrl="ngModel" [readonly]="readonly" required [min]="minDate" />
          <div *ngIf="employeeForm.submitted && civilIdExpiryCtrl.errors" class="text-danger small">
            <div *ngIf="civilIdExpiryCtrl.errors['required']">
              Civil ID Expiry is required.
            </div>
            <div *ngIf="civilIdExpiryCtrl.errors['min']">
              Expiry date must be in the future.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Civil ID Document</label>
          <div *ngIf="!readonly">
            <input type="file" class="form-control-file" (change)="onFileSelected($event, addOrGetDocIndex('Civil ID'))"
              [required]="!getDoc('Civil ID')?.fileUrl && !getDoc('Civil ID')?.file" />
            <small class="text-muted d-block" *ngIf="getDoc('Civil ID')?.fileUrl">
              Current: {{ getFileName(getDoc("Civil ID")?.fileUrl) }}
            </small>
          </div>
          <div *ngIf="readonly && getDoc('Civil ID')?.fileUrl" class="mt-2">
            <a [href]="getFullFileUrl(getDoc('Civil ID')?.fileUrl)" target="_blank"
              class="btn btn-sm btn-outline-primary">
              <i class="fa fa-download"></i>
              {{ getFileName(getDoc("Civil ID")?.fileUrl) }}
            </a>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Visa Expiry</label>
          <input type="date" class="form-control" [(ngModel)]="visaExpiry" name="visaExpiry" #visaExpiryCtrl="ngModel"
            [readonly]="readonly" required [min]="minDate" />
          <div *ngIf="employeeForm.submitted && visaExpiryCtrl.errors" class="text-danger small">
            <div *ngIf="visaExpiryCtrl.errors['required']">
              Visa Expiry is required.
            </div>
            <div *ngIf="visaExpiryCtrl.errors['min']">
              Expiry date must be in the future.
            </div>
          </div>
        </div>
      </div>

      <ng-container *ngIf="designation === 'Driver'">
        <div class="col-md-6 col-lg-4">
          <div class="form-group">
            <label>License No</label>
            <input type="text" class="form-control" [(ngModel)]="licenseNo" name="licenseNo" #licenseNoCtrl="ngModel"
              [readonly]="readonly" required />
            <div *ngIf="employeeForm.submitted && licenseNoCtrl.errors" class="text-danger small">
              <div *ngIf="licenseNoCtrl.errors['required']">
                License No is required for drivers.
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-4">
          <div class="form-group">
            <label>License Expiry</label>
            <input type="date" class="form-control" [(ngModel)]="licenseExpiry" name="licenseExpiry"
              #licenseExpiryCtrl="ngModel" [readonly]="readonly" required [min]="minDate" />
            <div *ngIf="employeeForm.submitted && licenseExpiryCtrl.errors" class="text-danger small">
              <div *ngIf="licenseExpiryCtrl.errors['required']">
                License Expiry is required for drivers.
              </div>
              <div *ngIf="licenseExpiryCtrl.errors['min']">
                Expiry date must be in the future.
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-4">
          <div class="form-group">
            <label>License Document</label>
            <div *ngIf="!readonly">
              <input type="file" class="form-control-file"
                (change)="onFileSelected($event, addOrGetDocIndex('License'))"
                [required]="!getDoc('License')?.fileUrl && !getDoc('License')?.file" />
              <small class="text-muted d-block" *ngIf="getDoc('License')?.fileUrl">
                Current: {{ getFileName(getDoc("License")?.fileUrl) }}
              </small>
            </div>
            <div *ngIf="readonly && getDoc('License')?.fileUrl" class="mt-2">
              <a [href]="getFullFileUrl(getDoc('License')?.fileUrl)" target="_blank"
                class="btn btn-sm btn-outline-primary">
                <i class="fa fa-download"></i>
                {{ getFileName(getDoc("License")?.fileUrl) }}
              </a>
            </div>
          </div>
        </div>
      </ng-container>
    </div>

    <!-- Bank Details -->
    <h5 class="mb-3 mt-4 border-bottom pb-2">Bank Details</h5>
    <div class="row">
      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Bank Name</label>
          <input type="text" class="form-control" [(ngModel)]="bankName" name="bankName" #bankNameCtrl="ngModel"
            [readonly]="readonly" required maxlength="30" pattern="^[A-Za-z ]+$" />
          <div *ngIf="employeeForm.submitted && bankNameCtrl.errors" class="text-danger small">
            <div *ngIf="bankNameCtrl.errors['required']">
              Bank Name is required.
            </div>
            <div *ngIf="bankNameCtrl.errors['maxlength']">
              Maximum 30 letters allowed.
            </div>
            <div *ngIf="bankNameCtrl.errors['pattern']">
              Only alphabets allowed.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Account No</label>
          <input type="text" class="form-control" [(ngModel)]="accountNo" name="accountNo" #accountNoCtrl="ngModel"
            [readonly]="readonly" required maxlength="30" pattern="^[0-9]+$" />
          <div *ngIf="employeeForm.submitted && accountNoCtrl.errors" class="text-danger small">
            <div *ngIf="accountNoCtrl.errors['required']">
              Account Number is required.
            </div>
            <div *ngIf="accountNoCtrl.errors['maxlength']">
              Maximum 30 digits allowed.
            </div>
            <div *ngIf="accountNoCtrl.errors['pattern']">
              Only numbers allowed.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>IFSC</label>
          <input type="text" class="form-control" [(ngModel)]="ifsc" name="ifsc" #ifscCtrl="ngModel"
            [readonly]="readonly" required maxlength="30" />
          <div *ngIf="employeeForm.submitted && ifscCtrl.errors" class="text-danger small">
            <div *ngIf="ifscCtrl.errors['required']">IFSC is required.</div>
            <div *ngIf="ifscCtrl.errors['maxlength']">
              Maximum 30 characters allowed.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Nominee & Contact -->
    <h5 class="mb-3 mt-4 border-bottom pb-2">Nominee & Contact</h5>
    <div class="row">
      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Nominee Name</label>
          <input type="text" class="form-control" [(ngModel)]="nomineeName" name="nomineeName"
            #nomineeNameCtrl="ngModel" [readonly]="readonly" required maxlength="30" pattern="^[A-Za-z ]+$" />
          <div *ngIf="employeeForm.submitted && nomineeNameCtrl.errors" class="text-danger small">
            <div *ngIf="nomineeNameCtrl.errors['required']">
              Nominee Name is required.
            </div>
            <div *ngIf="nomineeNameCtrl.errors['maxlength']">
              Maximum 30 letters allowed.
            </div>
            <div *ngIf="nomineeNameCtrl.errors['pattern']">
              Only alphabets allowed.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Relation</label>
          <select class="form-control" [(ngModel)]="nomineeRelation" name="nomineeRelation"
            #nomineeRelationCtrl="ngModel" [disabled]="readonly" required>
            <option value="" disabled>Select Relation</option>
            <option *ngFor="let relation of relations" [value]="relation">
              {{ relation }}
            </option>
          </select>
          <div *ngIf="employeeForm.submitted && nomineeRelationCtrl.errors" class="text-danger small">
            <div *ngIf="nomineeRelationCtrl.errors['required']">
              Relation is required.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Nominee Contact</label>
          <input type="text" class="form-control" [(ngModel)]="nomineeContact" name="nomineeContact"
            #nomineeContactCtrl="ngModel" [readonly]="readonly" required maxlength="15" pattern="^[0-9]+$" />
          <div *ngIf="employeeForm.submitted && nomineeContactCtrl.errors" class="text-danger small">
            <div *ngIf="nomineeContactCtrl.errors['required']">
              Nominee Contact is required.
            </div>
            <div *ngIf="nomineeContactCtrl.errors['maxlength']">
              Maximum 15 digits allowed.
            </div>
            <div *ngIf="nomineeContactCtrl.errors['pattern']">
              Only numbers allowed.
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4">
        <div class="form-group">
          <label>Employee Contact Number</label>
          <input type="text" class="form-control" [(ngModel)]="contactNumber" name="contactNumber"
            #contactNumberCtrl="ngModel" [readonly]="readonly" required maxlength="15" pattern="^[0-9]+$" />
          <div *ngIf="employeeForm.submitted && contactNumberCtrl.errors" class="text-danger small">
            <div *ngIf="contactNumberCtrl.errors['required']">
              Contact Number is required.
            </div>
            <div *ngIf="contactNumberCtrl.errors['maxlength']">
              Maximum 15 digits allowed.
            </div>
            <div *ngIf="contactNumberCtrl.errors['pattern']">
              Only numbers allowed.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Documents -->
    <h5 class="mb-3 mt-4 border-bottom pb-2">Additional Documents</h5>
    <div *ngFor="let doc of employeeDocuments; let i = index" class="row mb-3">
      <div class="col-md-4">
        <div class="form-group">
          <label>Document Type</label>
          <select class="form-control" [(ngModel)]="doc.type" name="documentType{{ i }}" [disabled]="readonly" required>
            <option value="" disabled>Select Document</option>
            <option value="Passport">Passport</option>
            <option value="Visa">Visa</option>
            <option value="Certificate">Certificate</option>
            <option value="License">License</option>
            <option value="Resume">Resume/CV</option>
          </select>
        </div>
      </div>
      <div class="col-md-4">
        <div class="form-group">
          <label>Document File</label>
          <div *ngIf="!readonly">
            <input type="file" class="form-control-file" (change)="onFileSelected($event, i)"
              [required]="!doc.fileUrl && !doc.file" />
            <small class="text-muted d-block" *ngIf="doc.fileUrl">
              Current: {{ getFileName(doc.fileUrl) }}
            </small>
          </div>
        </div>
      </div>
      <div class="col-md-4 d-flex align-items-center">
        <div *ngIf="doc.fileUrl" class="btn-group">
          <button type="button" class="btn btn-sm btn-info" (click)="previewDocument(doc.fileUrl)">
            <i class="fa fa-eye"></i> Preview
          </button>
          <a [href]="getFullFileUrl(doc.fileUrl)" download class="btn btn-sm btn-success">
            <i class="fa fa-download"></i> Download
          </a>
        </div>
      </div>
    </div>

    <div class="row mt-4" *ngIf="!readonly">
      <div class="col-12 text-right">
        <button type="button" class="btn btn-secondary mr-2" (click)="cancel()">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Employee</button>
      </div>
    </div>
  </form>
</div>