<div class="spare_parts_list_page">
  <div class="title_sec">
    <h4 class="page_title">Spare Parts Inventory</h4>
    <div class="d-flex gap-10">
      <input type="text" class="form-control me-2" placeholder="üîç Search by name / part number" [(ngModel)]="search"
        (ngModelChange)="onSearchChange()" />
      <button class="btn btn-primary" (click)="getSpareParts()">Search</button>
    </div>
  </div>

  <div class="table_section">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Part Name</th>
          <th>Part Number</th>
          <th>Description</th>
          <th>Quantity</th>
          <th>Unit Price</th>
          <th>Discount (%)</th>
          <th>Final Price</th>
          <th>Total Value</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let part of spareParts; let i = index">
          <td>{{ (page - 1) * limit + i + 1 }}</td>
          <td>{{ part.name }}</td>
          <td>{{ part.partNumber }}</td>
          <td>{{ part.description || "-" }}</td>
          <td>{{ part.totalQuantity }}</td>
          <td>
            {{
            part.addedBatches?.length
            ? part.addedBatches[part.addedBatches.length - 1].pricePerUnit
            : ("-" | currency : currency_code : currency_symbol)
            }}
          </td>
          <td>{{ part.discount || 0 }}%</td>
          <td>{{ part.finalPrice | currency : currency_code : currency_symbol }}</td>
          <td>{{ part.totalQuantity * part.finalPrice | currency : currency_code : currency_symbol }}</td>
          <td>
            <button class="btn btn-sm btn-warning" (click)="editSparePart(part._id)">
              ‚úèÔ∏è Edit
            </button>

          </td>
        </tr>

        <tr *ngIf="!loading && spareParts.length === 0">
          <td colspan="10" class="text-center">No spare parts found</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav *ngIf="total > limit" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="page === 1">
        <a class="page-link" (click)="onPageChange(page - 1)">Prev</a>
      </li>

      <li class="page-item" *ngFor="
          let p of [].constructor(Math.ceil(total / limit));
          let idx = index
        " [class.active]="page === idx + 1">
        <a class="page-link" (click)="onPageChange(idx + 1)">{{ idx + 1 }}</a>
      </li>

      <li class="page-item" [class.disabled]="page === Math.ceil(total / limit)">
        <a class="page-link" (click)="onPageChange(page + 1)">Next</a>
      </li>
    </ul>
  </nav>
</div>